---
title: "Simulation Update"
author: "Michael W Belitz"
date: "July 11, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(cowplot)
library(truncnorm)

source("scripts/summerscripts/simulation_vis/bimodal_median_vis.R")
source("scripts/summerscripts/simulation_vis/bimodal_onset_vis.R")
source("scripts/summerscripts/simulation_vis/bimodal_offset_vis.R")
source("scripts/summerscripts/simulation_vis/bimodal_tenth_vis.R")
source("scripts/summerscripts/simulation_vis/bimodal_ninty_vis.R")
source("scripts/summerscripts/simulation_vis/unimodal_median_vis.R")
source("scripts/summerscripts/simulation_vis/unimodal_onset_vis.R")
source("scripts/summerscripts/simulation_vis/unimodal_offset_vis.R")
source("scripts/summerscripts/simulation_vis/unimodal_tenth_vis.R")
source("scripts/summerscripts/simulation_vis/unimodal_ninty_vis.R")

```

# Unimodal Distribution

```{r simulation setup, echo=FALSE, include=FALSE}
set.seed(10)
obs_10sd <- rnorm(20000, mean = 200, sd = 10)
to_10sd <- as.data.frame(obs_10sd)

set.seed(365)
obs_20sd <- rnorm(20000, mean = 200, sd = 20)
to_20sd <- as.data.frame(obs_20sd)

set.seed(40)
obs_40sd <- rnorm(20000, mean = 200, sd = 40)
to_40sd <- as.data.frame(obs_40sd)
```


## Below are the simulated distributions of three hypothetical species. 

The distributions all have a mean of 200.
The standard deviations are 10 [Fig. 1], 20 [Fig. 2], and 40 [Fig. 3]

```{r, echo=FALSE}
tensd <- ggplot(data= to_10sd, aes(x = obs_10sd)) + geom_histogram(bins = 150)
tensd
```

Fig. 1 Distribution of number of adult individualsof a species that has a single peak and the most narrow flight length, although it is still 76 days from onset to offset (onset = 162; 10% = 186.99; 50% = 199.89; 90% = 212.76; max = 238.1).

```{r, echo=FALSE}
twentysd <- ggplot(data= to_20sd, aes(x = obs_20sd)) + geom_histogram(bins = 150)
twentysd
```
Fig. 2 Distribution of number of adult individuals of a species that has a single peak and has the middle flight length. In total the flight length is 159 days (onset = 119.68; 10% = 174.82; 50% = 200.19; 90% = 225.60; max = 279.35).


```{r, echo=FALSE}
fortysd <- ggplot(data= to_40sd, aes(x = obs_40sd)) + geom_histogram(bins = 150)
fortysd
```

Fig. 3 Distribution of number of adult individuals of a species that has a single peak and the longest flight length of the three single peak distributions we are examing. The flight length lasts almost the entiire year (onset = 35.88112, 10% = 149.30459; 50% = 199.80307; 90% = 251.79269; offset = 361.37887).

# Results of unimodal simulation

# Onset

For onset and offset estimates, I compared estimates derived from my biased-correcte weibull estimator to Will Pearse's R package. My estimator is similar in the MLE estimate but has smaller CIs. 

```{r onset, echo=FALSE}
plot(um_onset_cp)
```

Although both estimators perform similar in how many days away they estimate from the "true onset", Pearse's CI include the "true onset" more often because of the much larger CI.

```{r, echo=FALSE}
plot(uo)
```

# Tenth

My estimator does better at estimatin the 10 percentile than onset.  

```{r tenth, echo=FALSE}
plot(um_10_cp)
```

```{r, echo=FALSE}
plot(ut)
```

# Median

Median Estimates are even better.

```{r median, echo=FALSE}
plot(um_50_cp)
```

```{r, echo=FALSE}
plot(um)

```

# Ninety

```{r ninty, echo=FALSE}
plot(um_90_cp)
```

```{r, echo=FALSE}
plot(un)
```

# Offset 

```{r offset, echo=FALSE}
plot(um_offset_cp)
```

```{r, echo=FALSE}
plot(uf)
```

## Bimodal Distribution

```{r bimodal simulation setup, echo=FALSE, include=FALSE}
nn <- 20000
#10 SD
set.seed(1)
sims_10sd <- c(rtruncnorm(nn * (1/3), a=0, b=365, mean=150, sd=10),
          rtruncnorm(nn * (2/3), a=0, b=365, mean=220, sd=10))
sim_10sd_df <- as.data.frame(sims_10sd)

set.seed(1)
sims_20sd <- c(rtruncnorm(nn * (1/3), a=0, b=365, mean=150, sd=20),
               rtruncnorm(nn * (2/3), a=0, b=365, mean=220, sd=20))
sim_20sd_df <- as.data.frame(sims_20sd)
```


# Below are the simulated distributions of two hypothetical species. 

The first represents a species that is Bivoltine with 2/3 of its population density occurring in the second flight peak and overall a narrow flight length per brood that has little overlap (Mean 150 and 220, 10 SD).

```{r, echo=FALSE}
bmtsd <- ggplot(data= sim_10sd_df, aes(x = sims_10sd)) + geom_histogram(bins = 150)
bmtsd
```


The next represents a species with a longer flight length, so more overlap between the two broods (Mean 150 and 220, 20 SD).

```{r, echo=FALSE}
bmtwsd <- ggplot(data= sim_20sd_df, aes(x = sims_20sd)) + geom_histogram(bins = 150)
bmtwsd
```

# Results of Bimodal simulation

# Onset

```{r onset2, echo=FALSE}
plot(bm_onset_cp)
```

```{r, echo=FALSE}
plot(bo)
```

# Tenth

My estimator does better at estimatin the 10 percentile than onset.  

```{r tenth2, echo=FALSE}
plot(bm_10_cp)
```

```{r, echo=FALSE}
plot(bt)
```

# Median

Median Estimates 

```{r median2, echo=FALSE}
plot(bm_50_cp)
```

```{r, echo=FALSE}
plot(bm)

```

# Ninety

```{r ninty2, echo=FALSE}
plot(bm_90_cp)
```

```{r, echo=FALSE}
plot(bn)
```

# Offset 

```{r offset2, echo=FALSE}
plot(bm_offset_cp)
```

```{r, echo=FALSE}
plot(bf)
```